# 内存对齐

## 1. 主要作用

* 平台原因(移植原因)：不是所有的硬件平台都能访问任意地址上的任意数据的；某些硬件平台只能在某些地址处取某些特定类型的数据，否则抛出硬件异常

* CPU在读取内存时是一块一块进行读取的

  假设CPU要读取一个int型4字节大小的数据到寄存器中，分两种情况讨论：
  1、数据从0字节开始
  2、数据从1字节开始

  再次假设内存读取粒度为4。

  - 当该数据是从0字节开始时，CPU只需读取内存一次即可把这4字节的数据完全读取到寄存器中。
  - 当该数据是从1字节开始时，问题变的有些复杂，此时该int型数据不是位于内存读取边界上，这就是一类内存未对齐的数据。
    此时CPU先访问一次内存，读取0—3字节的数据进寄存器，并再次读取4—5字节的数据进寄存器，接着把0字节和6，7，8字节的数据剔除，最后合并1，2，3，4字节的数据进寄存器。对一个内存未对齐的数据进行了这么多额外的操作，大大降低了CPU性能。

## 2. struct/class/union内存对齐原则有四个

